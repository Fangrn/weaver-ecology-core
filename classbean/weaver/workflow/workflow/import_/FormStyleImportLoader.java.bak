package weaver.workflow.workflow.import_;

import java.io.File;
import java.lang.reflect.Method;
import java.util.Map;

import weaver.general.GCONST;
import weaver.workflow.workflow.importwf.ParentLastClassLoader;

public class FormStyleImportLoader
{
  private ClassLoader loader = null;
  private static FormStyleImportLoader importLoader = null;

  private Object checkInstance = null;
  private Method checkMethod = null;


  public static synchronized FormStyleImportLoader getInstance() {
    if (importLoader == null) {
      importLoader = new FormStyleImportLoader();
      importLoader.initLoader();
    }
    return importLoader;
  }

  private void initLoader() {
    try {
    	String libpath = GCONST.getRootPath()+"WEB-INF"+File.separatorChar+"lib_reader"+File.separatorChar;
    	String libpath2 = GCONST.getRootPath()+"lib_wfimport"+File.separatorChar+"wfimport.jar";
      this.loader = 
        new ParentLastClassLoader(Thread.currentThread().getContextClassLoader(), 
        new String[] { libpath + "/transExcelOperation.jar", libpath + "/wf-xmlbeans-2.3.0.jar", libpath + "/wf-poi-3.13.jar", libpath + "/wf-poi-ooxml-schemas-1.1.jar", libpath + "/wf-poi-ooxml-3.13.jar",libpath2 });
      Class myClass = null;

      myClass = this.loader.loadClass("weaver.workflow.workflow.import_.FormStyleImport");
      this.checkInstance = myClass.newInstance();
      this.checkMethod = myClass.getMethod("importExcel", new Class[] { String.class, Map.class,Map.class });

    } catch (Exception e) {
      System.err.println("类加载poi-3.13异常");
      e.printStackTrace();
    }
  }


  public Object importExcel(String filepath, Map<String, String> wfinfo, Map<String, Object> fieldinfo) {
    try {
      return this.checkMethod.invoke(this.checkInstance, new Object[] { filepath,wfinfo, fieldinfo });
    } catch (Exception e) {
      e.printStackTrace();
    }
    return null;
  }
}
